<h1>Consultar producto</h1>

<div class="card-head">
    <mat-card>
        <form [formGroup]="consultForm">
            <div class="search-container">
                <div class="normal-search">
                    <input type="search" name="search" id="search" class="search" placeholder="Consultar producto"
                           autocomplete="off" formControlName="name">
                    <i class="fa fa-search search-icon"></i>
                    <button mat-raised-button color="primary" class="buscar" (click)="loadProducts(consultForm.value)">
                        BUSCAR
                    </button>
                </div>
            </div>
        </form>
    </mat-card>
</div>
<div *ngFor="let product of products">
    <div *ngIf="product.active">
        <div class="card card1">
            <div class="card-header">
                <div class="update">
                    <h2>Detalles del Producto</h2>
                    <button mat-icon-button (click)=openUpdateDialog(product)>
                        <mat-icon *ngIf="!loadingCategories">update</mat-icon>
                    </button>
                </div>
            </div>

            <div class="card-body">
                <div class="container">
                    <div class="row">
                        <div class="col-3">
                            <div class="form-field">
                                <label>Nombre del Producto:</label>
                                {{ products[0].name }}
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-field">
                                <label>Categoría:</label>
                                {{products[0].description}}
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-field">
                                <label>Unidades Disponibles:</label>
                                {{products[0].unitsAvailable}}
                            </div>
                        </div>
                    </div>
                    <div class="row form-2">
                        <div class="col-3">
                            <div class="form-field form-field2">
                                <label>Precio:</label>
                                {{products[0].price}}
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-field">
                                <label>Característica:</label>
                                {{products[0].characteristic}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-field">
                    <label>Ficha Técnica:</label>
                    <embed *ngIf="product.datasheet" [src]="product.datasheet" type="application/pdf" width="100%"
                           height="500px">
                </div>
                <div class="form-field">
                    <label>Imagenes del producto:</label>
                </div>
                <div class="carrusel-container">
                    <p-carousel [value]="imageList" [numVisible]="4" [numScroll]="3" [circular]="true"
                                [responsiveOptions]="responsiveOptions">
                        <ng-template let-imageR let-i="index" pTemplate="item">
                            <div class="border-1 surface-border border-round m-2 text-center py-5 px-3">
                                <div class="mb-3">
                                    <img [src]="imageR" alt="Imagen del Producto">
                                    <mat-icon class="update-icon" (click)="openUpdateDialog2(product)">
                                        update
                                    </mat-icon>
                                </div>
                            </div>
                        </ng-template>
                    </p-carousel>
                </div>
                <div class="add-image-container">
                    <mat-icon>add_a_photo</mat-icon>
                    <span (click)="fileInput.click()">Añadir imagen al producto</span>
                    <input #fileInput type="file" style="display:none" (change)="onFileSelected($event)">
                </div>
                <div *ngIf="showImagePreview" class="simple-dialog">
                    <div class="dialog-content">
                        <h2>¿Quieres añadir esta imagen al producto?</h2>
                        <img [src]="currentImage" alt="Imagen del Producto">
                        <div class="dialog-buttons">
                            <button class="accept" (click)="acceptImage()">Aceptar</button>
                            <button class="cancel" (click)="closeImagePreview()">Cancelar</button>
                        </div>
                    </div>
                </div>
                <div *ngIf="showImagePreview" class="simple-dialog">
                    <div class="dialog-content">
                        <h2>¿Quieres añadir esta imagen al producto?</h2>
                        <img [src]="currentImage" alt="Imagen del Producto">
                        <div class="dialog-buttons">
                            <button class="accept" (click)="acceptImage()">Aceptar</button>
                            <button class="cancel" (click)="closeImagePreview()">Cancelar</button>
                        </div>
                    </div>
                </div>
                <div *ngIf="showUpdateDialog" class="custom-dialog">
                    <div class="dialog-content">
                        <h2>Actualizar Producto</h2>
                        <form [formGroup]="updateForm">
                            <div class="form-field">
                                <label for="updateName">Nuevo Nombre del Producto:</label>
                                <input type="text" id="updateName" formControlName="name"/>
                            </div>
                            <div class="form-field">
                                <label for="updatePrice">Nuevo Precio:</label>
                                <input type="text" id="updatePrice" formControlName="price"/>
                            </div>
                            <div class="form-field">
                                <label for="updateUnitsAvailable">Nuevas Unidades Disponibles:</label>
                                <input type="text" id="updateUnitsAvailable" formControlName="unitsAvailable"/>
                            </div>
                            <div class="form-field">
                                <label for="updateCategory">Nueva Categoría:</label>
                                <select id="updateCategory" formControlName="idCategory">
                                    <option *ngFor="let category of categories" [value]="category.idCategory">
                                        {{ category.description }}
                                    </option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label for="updateCharacteristic">Nueva Característica:</label>
                                <input type="text" id="updateCharacteristic" formControlName="characteristic"/>
                            </div>
                            <div class="form-field">
                                <label for="updateDatasheet">Nuevo Datasheet:</label>
                                <input type="file" id="updateDatasheet" formControlName="datasheet"
                                       (change)="onFileSelected1($event)"/>
                            </div>
                            <button mat-raised-button color="accent" class="update-button"
                                    (click)="updateProduct(updateForm.value)">Actualizar
                            </button>
                        </form>

                        <button class="close-button" (click)="closeUpdateDialog()">Cerrar</button>
                    </div>
                </div>
                <div *ngIf="showUpdateImageDialog" class="image-dialog">
                    <div class="dialog-content">
                        <h2>Actualizar Imagen</h2>
                        <form [formGroup]="updateForm">
                            <div class="form-field">
                                <label for="updateImage">Nueva Imagen:</label>
                                <input type="file" id="updateImage" formControlName="image"
                                       (change)="loadImage($event)"/>
                            </div>
                            <button class="update-button" (click)="updateImage()">Actualizar</button>
                        </form>

                        <button class="close-button" (click)="closeUpdateImageDialog()">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
